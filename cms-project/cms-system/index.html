<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« ç®¡ç†ç³»ç»ŸCMS</title>
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <div id="app">

        <div class="container">
            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <div class="logo">
                    <h1>CMSç®¡ç†ç³»ç»Ÿ</h1>
                </div>
                <ul class="menu">
                    <li class="active"><span>ğŸ“</span> æ–‡ç« ç®¡ç†</li>
                </ul>
            </div>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <div class="main-content">
                <div class="header">
                    <h2>æ–‡ç« ç®¡ç†ç³»ç»Ÿ</h2>
                    <div class="actions">
                        <button class="btn-new" @click="createNewArticle">æ–°å»ºæ–‡ç« </button>
                        <button class="btn-preview" @click="showPreview">é¢„è§ˆ</button>
                        <button class="btn-generate" @click="generateHTML">ç”ŸæˆHTML</button>
                        <button class="btn-save" @click="saveArticle">ä¿å­˜æ–‡ç« </button>
                    </div>
                </div>

                <div class="content-area">
                    <!-- æ–‡ç« åˆ—è¡¨åŒºåŸŸ -->
                    <div class="articles-panel">
                        <h2>
                            æ–‡ç« åˆ—è¡¨
                            <span class="articles-count">å…±{{ pagesTotal }}ç¯‡æ–‡ç« </span>
                        </h2>

                        <div class="search-box">
                            <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜" v-model="searchText" @keyup.enter="filterArticles">
                            <button @click="filterArticles">æœç´¢</button>
                        </div>

                        <div class="filter-options">
                            <select v-model="categoryFilter" @change="filterArticles">
                                <option value="">æ‰€æœ‰åˆ†ç±»</option>
                                <option v-for="(name, value) in categories" :value="value">{{ name }}</option>
                            </select>

                            <select v-model="statusFilter" @change="filterArticles">
                                <option value="">æ‰€æœ‰çŠ¶æ€</option>
                                <option v-for="(name, value) in statuses" :value="value">{{ name }}</option>
                            </select>
                        </div>

                        <div class="articles-list">
                            <div v-for="article in articles" :key="article._id"
                                :class="['article-item', { active: currentArticle._id === article._id }]"
                                @click="loadArticle(article._id)">
                                <span :class="['article-status', `status-${article.status}`]">
                                    {{ statuses[article.status] }}
                                </span>
                                <div class="article-title">
                                    {{ article.title }}
                                </div>
                                <div class="article-meta">
                                    <span>{{ categories[article.category] || 'æœªåˆ†ç±»' }}</span>
                                    <span>{{ formatDate(article.lastSaved) }}</span>
                                </div>
                                <div class="article-excerpt">{{ getExcerpt(article.content) }}</div>
                                    <!-- æ–°å¢ URL åŒºåŸŸ -->
                                    <div class="article-url">
                                        <input type="text" :value="article.slug || ''" readonly ref="urlInput" />
                                        <button @click.stop="copyUrl(article.slug)">å¤åˆ¶</button>
                                    </div>

                            </div>
                            <div v-if="filteredArticles.length === 0" class="article-item">
                                æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« 
                            </div>
                        </div>
                        <div class="pagination">
                            <button @click="toGetListCut" :disabled="currentPage === 1">ä¸Šä¸€é¡µ</button>
                            <span>ç¬¬ {{ currentPage }} / {{ totalPages }} é¡µ</span>
                            <button @click="toGetListAdd" :disabled="currentPage === totalPages">ä¸‹ä¸€é¡µ</button>
                        </div>
                    </div>

                    <!-- æ–‡ç« ç¼–è¾‘åŒºåŸŸ -->
                    <div class="editor-panel">
                        <h2>ç¼–è¾‘æ–‡ç« : {{ currentArticle.title.substring(0, 20) }}{{ currentArticle.title.length > 20 ? '...'
                            : '' }}</h2>
                        <div class="form-group">
                            <label for="article-title">æ–‡ç« æ ‡é¢˜</label>
                            <input type="text" id="article-title" v-model="currentArticle.title" placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label for="article-category">æ–‡ç« åˆ†ç±»</label>
                            <select id="article-category" v-model="currentArticle.category">
                                <option value="">é€‰æ‹©åˆ†ç±»</option>
                                <option v-for="(name, value) in categories" :value="value">{{ name }}</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="article-status">æ–‡ç« çŠ¶æ€</label>
                            <select id="article-status" v-model="currentArticle.status">
                                <option v-for="(name, value) in statuses" :value="value">{{ name }}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="article-content">æ–‡ç« å†…å®¹</label>
                            <div class="editor-toolbar">
                                <button type="button" title="åŠ ç²—" @click="formatText('bold')">B</button>
                                <button type="button" title="æ–œä½“" @click="formatText('italic')">I</button>
                                <button type="button" title="é“¾æ¥" @click="insertLink">ğŸ”—</button>
                                <button type="button" title="å›¾ç‰‡" @click="insertImage">ğŸ–¼ï¸</button>
                            </div>
                            <div class="editor" contenteditable="true" @input="updateContent">
                            </div>
                        </div>

                    </div>
                    <!-- SEO é…ç½®åŒºåŸŸ -->
                    <div class="articles-panel">
                        <h2>
                            SEOé…ç½®
                            <!-- é»˜è®¤ SEO è®¾ç½®æŒ‰é’® -->
                            <button class="btn-default-seo" @click="showDefaultSeoModal = true">é…ç½®é»˜è®¤ SEO</button>
                        </h2>

                        <div class="form-group">
                            <label for="seo-title">SEO æ ‡é¢˜</label>
                            <input type="text" id="seo-title" v-model="currentArticle.seoTitle" placeholder="æ–‡ç«  SEO æ ‡é¢˜">
                        </div>

                        <div class="form-group">
                            <label for="seo-description">SEO æè¿°</label>
                            <textarea id="seo-description" v-model="currentArticle.seoDescription"
                                placeholder="æ–‡ç«  SEO æè¿°ï¼Œå»ºè®® 150 å­—ä»¥å†…"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="seo-keywords">SEO å…³é”®å­—</label>
                            <input type="text" id="seo-keywords" v-model="currentArticle.seoKeywords"
                                placeholder="æ–‡ç«  SEO å…³é”®å­—ï¼Œç”¨é€—å·åˆ†éš”">
                        </div>
                    </div>

                </div>

                <div class="status-bar">
                    <div class="status-info">
                        <span>æœ€åä¿å­˜: {{ formatDate(currentArticle.updatedAt) }}</span>
                        <span>çŠ¶æ€: {{ statuses[currentArticle.status] }}</span>
                    </div>
                    <div class="status-actions">
                        <span>å­—æ•°: {{ wordCount }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
        <div :class="['preview-modal', { show: showPreviewModal }]" @click.self="showPreviewModal = false">
            <div class="preview-content">
                <div class="preview-header">
                    <h3>æ–‡ç« é¢„è§ˆ - {{ currentArticle.title }}</h3>
                    <button class="close-preview" @click="showPreviewModal = false">å…³é—­é¢„è§ˆ</button>
                </div>
                <iframe class="preview-iframe" :srcdoc="previewHTML"></iframe>
            </div>
        </div>
        <!-- åŠ è½½åŠ¨ç”» -->
        <div v-if="isLoading" class="loading-overlay">
            <div class="spinner"></div>
        </div>
        <!-- é»˜è®¤ SEO å¼¹çª— -->
        <div v-if="showDefaultSeoModal" class="modal-overlay" @click.self="showDefaultSeoModal = false">
            <div class="modal-content">
                <h3>é…ç½®é»˜è®¤ SEO</h3>
                <div class="form-group">
                    <label>é»˜è®¤ SEO æ ‡é¢˜</label>
                    <input type="text" v-model="defaultSeo.seoTitle" placeholder="é»˜è®¤ SEO æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label>é»˜è®¤ SEO æè¿°</label>
                    <textarea v-model="defaultSeo.seoDescription" placeholder="æ–‡ç«  SEO æè¿°ï¼Œå»ºè®® 150 å­—ä»¥å†…"></textarea>
                </div>
                <div class="form-group">
                    <label>é»˜è®¤ SEO å…³é”®å­—</label>
                    <input type="text" v-model="defaultSeo.seoKeywords" placeholder="é»˜è®¤ SEO å…³é”®å­—ï¼Œç”¨é€—å·åˆ†éš”">
                </div>
                <div class="modal-actions">
                    <button @click="saveDefaultSeo">ä¿å­˜</button>
                    <button @click="showDefaultSeoModal = false">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        <!-- å›¾ç‰‡ä¸Šä¼ å¼¹çª— -->
        <div v-if="showImageModal" class="image-upload-dialog" @click.self="showImageModal = false">
            <div class="image-upload-dialog__content">
                <h3>ä¸Šä¼ å›¾ç‰‡</h3>
                <input type="file" @change="handleFileChange" accept="image/*" />
                <div class="image-upload-dialog__actions">
                    <button @click="uploadImage" :disabled="!selectedFile">ä¸Šä¼ </button>
                    <button @click="showImageModal = false">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

    </div>

    <script type="module" src="scripts/app.js"></script>
</body>

</html>